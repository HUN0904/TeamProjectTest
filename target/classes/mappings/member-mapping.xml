<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="MemberMapper">
	<!--  -->
	<select id="getMember" resultType="member">
		select * from member where id=#{id}
	</select>
	<!--  -->
	<select id="confirmID" resultType="String">
		select pwd from member where id=#{id}
	</select>
	
	<select id="adminCheck" resultType="String">
		SELECT admin FROM member WHERE id=#{id}
	</select>
	
	<insert id="insertMember">
		INSERT INTO member(id, pwd, name, email, address, nickname, phone)
		VALUES (#{id}, #{pwd}, #{name}, #{email}, #{address}, #{nickname}, #{phone})
	</insert>
	
<!-- 이름과 이메일로 아이디 찾기  -->
	<select id="selectIdByNameEmail" resultType="String">
		SELECT id FROM member WHERE name=#{name}
	</select>
	
<!-- 아이디, 이름, 이메일로 비밀번호 찾기  -->
	<select id="selectPwdByIdNameEmail" resultType="String">
		SELECT pwd FROM member WHERE id=#{id} AND name=#{name} AND email=#{email}
	</select>
	
<!-- 비밀번호 변경 -->
	<update id="changePwd">
		UPDATE member SET pwd=#{pwd} WHERE id=#{id}
	</update>
	
<!-- 메일 보내기 -->
	<select id="getPwdByNameEmail" resultType="String">
		SELECT pwd FROM member WHERE name = #{name}
	</select>
	
	<!-- 회원 등급 업데이트 -->
	<update id="gradeUpdate">
		 UPDATE member SET grade = #{grade} WHERE id = #{id}
	</update>
	
	<!-- 등급 업데이트 대상 아이디 검색 -->
	<select id="sumPriceById" resultType="String">
		<![CDATA[
		 SELECT m.id FROM member m, cart c, order_detail od
	   	  WHERE m.id = c.id 
	        AND c.cart_no = od.cart_no
	        AND od.result = '1'
	        GROUP BY m.id
	        HAVING SUM(c.total_price) >= #{sum_price}
	        ]]>
	</select>
</mapper>
