<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="OrderMapper">
  
  	<select id="selectMaxOrder_no" resultType="int">
		SELECT NVL2(MAX(order_no), MAX(order_no)+1, 1) FROM orders
	</select>
  
	<insert id="orderInsert">
		INSERT INTO orders(order_no,id) VALUES(#{order_no},#{id})
	</insert>
 
	<insert id="orderDetailInsert">
		INSERT INTO order_detail(order_dno, order_no, product_no, quantity)
		VALUES(order_detail_seq.NEXTVAL, #{order_no}, #{product_no}, #{quantity})	
	</insert>
  
 	<select id="orderListById" resultType="order">
		SELECT * FROM order_view
		 WHERE id=#{id} ORDER BY indate,odresult DESC
	</select>
  
	<select id="orderList" resultType="order">
		SELECT * FROM order_view
		 WHERE product_name LIKE '%'||#{product_name}||'%'
		 ORDER BY order_dno,odresult DESC
	</select>
  
 	<select id="orderListByDate" resultType="order">
		SELECT * FROM order_view
		 WHERE TO_CHAR(pickup_date,'yyyy/MM/dd') LIKE '%'||#{pickup_date}||'%'
		   AND odresult = '1'
		 ORDER BY pickup_date
	</select>  	
  
   	<select id="getOrderDetail" resultType="order">
		SELECT * FROM order_view
		 WHERE id=#{id} AND order_dno = #{order_dno}
		 ORDER BY indate,odresult DESC
	</select>	
	
	<select id="getAdminOrderDetail" resultType="order">
		SELECT * FROM order_view
		 WHERE order_dno = #{order_dno}
		 ORDER BY indate,odresult DESC
	</select>
	
	<update id="updateOrderResult">
		UPDATE order_detail
		   SET result = '1'
		 WHERE order_dno = #{order_dno}
	</update>
	

	
</mapper>
